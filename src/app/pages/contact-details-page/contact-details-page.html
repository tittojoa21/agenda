<div class="contact-details-page">
  @if (cargandoContacto) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Cargando información del contacto...</p>
    </div>
  } @else if (!contacto) {
    <div class="error-state">
      <div class="error-content">
        <div class="error-icon">
          <svg viewBox="0 0 24 24" width="48" height="48">
            <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
          </svg>
        </div>
        <h3>Error al cargar el contacto</h3>
        <p>No se pudo encontrar la información del contacto solicitado.</p>
        <div class="error-actions">
          <button class="btn-primary" (click)="goBack()">
            <svg viewBox="0 0 24 24" width="16" height="16">
              <path fill="currentColor" d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
            </svg>
            Volver a la lista
          </button>
          <button class="btn-secondary" (click)="reloadContact()">
            <svg viewBox="0 0 24 24" width="16" height="16">
              <path fill="currentColor" d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
            </svg>
            Reintentar
          </button>
        </div>
      </div>
    </div>
  } @else {
    <div class="contact-details">
      <div class="contact-header">
        <button class="back-btn" (click)="goBack()">
          <svg viewBox="0 0 24 24" width="16" height="16">
            <path fill="currentColor" d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
          </svg>
          Volver
        </button>
        
        <div class="header-actions">
          <button class="btn-icon favorite-btn" (click)="toggleFavorite()" 
                  [class.favorited]="contacto.isFavorite"
                  [title]="contacto.isFavorite ? 'Quitar de favoritos' : 'Agregar a favoritos'">
            <svg viewBox="0 0 24 24" width="20" height="20">
              <path fill="currentColor" d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
            </svg>
          </button>
          <button class="btn-icon edit-btn" (click)="editContact()" title="Editar contacto">
            <svg viewBox="0 0 24 24" width="20" height="20">
              <path fill="currentColor" d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
            </svg>
          </button>
          <button class="btn-icon delete-btn" (click)="deleteContact()" title="Eliminar contacto">
            <svg viewBox="0 0 24 24" width="20" height="20">
              <path fill="currentColor" d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
            </svg>
          </button>
        </div>
      </div>

      <div class="contact-card">
        <div class="contact-avatar">
          @if (contacto.image) {
            <div class="avatar-image">
              <img [src]="contacto.image" [alt]="getFullName()" (error)="handleImageError($event)">
            </div>
          } @else {
            <div class="avatar-initials">
              {{ getContactInitials() }}
            </div>
          }
          <div class="favorite-indicator" [class.active]="contacto.isFavorite" 
               [title]="contacto.isFavorite ? 'Contacto favorito' : ''">
            <svg viewBox="0 0 24 24" width="14" height="14">
              <path fill="currentColor" d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
            </svg>
          </div>
        </div>

        <div class="contact-info">
          <h1 class="contact-name">{{ contacto.firstName }} {{ contacto.lastName }}</h1>
          
          @if (contacto.company) {
            <p class="contact-title">
              {{ contacto.company }}
            </p>
          }
          
          @if (contacto.description) {
            <p class="contact-description">
              {{ contacto.description }}
            </p>
          }
          
          <div class="contact-badges">
            @if (contacto.email) {
              <span class="badge" title="Tiene email">
                Email
              </span>
            }
            @if (contacto.number) {
              <span class="badge" title="Tiene teléfono">
                Teléfono
              </span>
            }
            @if (contacto.address) {
              <span class="badge" title="Tiene dirección">
                Dirección
              </span>
            }
          </div>
        </div>
      </div>

      <div class="tab-content">
        <div class="tab-pane info-tab">
          
          @if (hasContactInfo()) {
            <section class="info-section">
              <h2 class="section-title">
                Información de Contacto
              </h2>
              
              <div class="info-grid">
                @if (contacto.email) {
                  <div class="info-item">
                    <div class="info-icon">
                      <div class="info-circle"></div>
                    </div>
                    <div class="info-content">
                      <div class="info-text">
                        <label class="info-label">Email</label>
                        <a [href]="'mailto:' + contacto.email" class="info-value" 
                           target="_blank" rel="noopener">
                          {{ contacto.email }}
                        </a>
                      </div>
                      <button class="copy-btn" (click)="copyToClipboard(contacto.email)" 
                              title="Copiar email">
                        <svg viewBox="0 0 24 24" width="16" height="16">
                          <path fill="currentColor" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                        </svg>
                      </button>
                    </div>
                  </div>
                }

                @if (contacto.number) {
                  <div class="info-item">
                    <div class="info-icon">
                      <div class="info-circle"></div>
                    </div>
                    <div class="info-content">
                      <div class="info-text">
                        <label class="info-label">Teléfono</label>
                        <a [href]="'tel:' + contacto.number" class="info-value">
                          {{ formatPhoneNumber(contacto.number) }}
                        </a>
                      </div>
                      <button class="copy-btn" (click)="copyToClipboard(contacto.number)" 
                              title="Copiar teléfono">
                        <svg viewBox="0 0 24 24" width="16" height="16">
                          <path fill="currentColor" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                        </svg>
                      </button>
                    </div>
                  </div>
                }

                @if (contacto.address) {
                  <div class="info-item">
                    <div class="info-icon">
                      <div class="info-circle"></div>
                    </div>
                    <div class="info-content">
                      <div class="info-text">
                        <label class="info-label">Dirección</label>
                        <span class="info-value">{{ contacto.address }}</span>
                      </div>
                      <button class="copy-btn" (click)="copyToClipboard(contacto.address)" 
                              title="Copiar dirección">
                        <svg viewBox="0 0 24 24" width="16" height="16">
                          <path fill="currentColor" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                        </svg>
                      </button>
                    </div>
                  </div>
                }
              </div>
            </section>
          }

          @if (contacto.company) {
            <section class="info-section">
              <h2 class="section-title">
                Información Profesional
              </h2>
              
              <div class="info-grid">
                <div class="info-item">
                  <div class="info-icon">
                    <div class="info-circle"></div>
                  </div>
                  <div class="info-content">
                    <div class="info-text">
                      <label class="info-label">Compañía</label>
                      <span class="info-value">{{ contacto.company }}</span>
                    </div>
                  </div>
                </div>
              </div>
            </section>
          }

          @if (contacto.description) {
            <section class="info-section">
              <h2 class="section-title">
                Notas
              </h2>
              <div class="notes-content">
                <p>{{ contacto.description }}</p>
              </div>
            </section>
          }
        </div>
      </div>

      <div class="quick-actions">
        @if (contacto.number) {
          <a [href]="'tel:' + contacto.number" class="action-btn primary" 
             title="Llamar a {{ getFullName() }}">
            Llamar
          </a>
        }
        
        @if (contacto.email) {
          <a [href]="'mailto:' + contacto.email" class="action-btn secondary"
             title="Enviar email a {{ contacto.email }}">
            Email
          </a>
        }
        
        @if (contacto.number) {
          <a [href]="'sms:' + contacto.number" class="action-btn secondary"
             title="Enviar SMS a {{ contacto.number }}">
            SMS
          </a>
        }
        
        <button class="action-btn secondary" (click)="shareContact()" title="Compartir contacto">
          Compartir
        </button>
      </div>
      
      @if (showToast) {
        <div class="toast" [class.show]="showToast">
          <svg viewBox="0 0 24 24" width="20" height="20">
            <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
          </svg>
          <span>{{ toastMessage }}</span>
        </div>
      }
    </div>
  }
</div>