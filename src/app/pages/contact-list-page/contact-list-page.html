<div class="contact-list-page">
  <div class="header-section">
    <div class="header-content">
      <h1 class="page-title">
        Mis Contactos
      </h1>
    </div>

    <div class="search-section">
      <div class="search-container">
        <input 
          type="text" 
          placeholder="Buscar contactos..." 
          class="search-input"
          [value]="searchTerm"
          (input)="onSearch($event)">
        @if (searchTerm) {
          <button class="clear-search" (click)="clearSearch()">
            <svg viewBox="0 0 24 24">
              <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
            </svg>
          </button>
        }
      </div>
    </div>
  </div>

  @if (isLoading) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Cargando contactos...</p>
    </div>
  } @else if (showError && !isLoading) {
    <div class="error-state">
      <div class="error-content">
        <svg viewBox="0 0 24 24">
          <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
        </svg>
        <h3>Error al cargar contactos</h3>
        <p>{{ errorMessage }}</p>
        <button class="btn-primary" (click)="reloadContacts()">
          <svg viewBox="0 0 24 24">
            <path fill="currentColor" d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
          </svg>
          Reintentar
        </button>
      </div>
    </div>
  } @else if (!isLoading && !showError) {
    <div class="stats-section">
      <div class="stat-card">
        <div class="stat-icon">
        </div>
        <div class="stat-info">
          <span class="stat-number">{{ totalContacts }}</span>
          <span class="stat-label">Contactos totales</span>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon favorite">
        </div>
        <div class="stat-info">
          <span class="stat-number">{{ getFavoriteCount() }}</span>
          <span class="stat-label">Favoritos</span>
        </div>
      </div>
    </div>

    <div class="contacts-section">
      <div class="section-header">
        <h2>Lista de Contactos</h2>
        <button class="toggle-form-btn" (click)="toggleContactForm()">
          {{ showContactForm ? 'Cancelar' : 'Nuevo Contacto' }}
        </button>
      </div>

      <div class="contact-form-container" [class.active]="showContactForm">
        <div class="form-card">
          <h3>
            Crear Nuevo Contacto
          </h3>
          
          <form (ngSubmit)="createContact()" class="contact-form">
            <div class="form-grid">
              <div class="form-group required">
                <label for="first-name" class="form-label">
                  Nombre
                </label>
                <input 
                  type="text" 
                  id="first-name" 
                  [(ngModel)]="newContact.firstName"
                  name="firstName"
                  required
                  maxlength="50" 
                  placeholder="Ingresa el nombre"
                  class="form-input">
              </div>

              <div class="form-group">
                <label for="last-name" class="form-label">
                  Apellido
                </label>
                <input 
                  type="text" 
                  id="last-name" 
                  [(ngModel)]="newContact.lastName"
                  name="lastName"
                  maxlength="50"
                  placeholder="Ingresa el apellido"
                  class="form-input">
              </div>

              <div class="form-group">
                <label for="email" class="form-label">
                  Email
                </label>
                <input 
                  type="email" 
                  id="email" 
                  [(ngModel)]="newContact.email"
                  name="email"
                  maxlength="50"
                  placeholder="ejemplo@correo.com"
                  class="form-input">
              </div>

              <div class="form-group required">
                <label for="number" class="form-label">
                  Teléfono
                </label>
                <input 
                  type="tel" 
                  id="number" 
                  [(ngModel)]="newContact.number"
                  name="number"
                  required
                  minlength="4" 
                  maxlength="50" 
                  placeholder="+1 234 567 890"
                  class="form-input">
              </div>

              <div class="form-group full-width">
                <label for="address" class="form-label">
                  Dirección
                </label>
                <input 
                  type="text" 
                  id="address" 
                  [(ngModel)]="newContact.address"
                  name="address"
                  maxlength="50"
                  placeholder="Ingresa la dirección"
                  class="form-input">
              </div>

              <div class="form-group">
                <label for="company" class="form-label">
                  Compañía
                </label>
                <input 
                  type="text" 
                  id="company" 
                  [(ngModel)]="newContact.company"
                  name="company"
                  maxlength="50"
                  placeholder="Nombre de la compañía"
                  class="form-input">
              </div>

              <div class="form-group full-width">
                <label for="description" class="form-label">
                  Descripción
                </label>
                <textarea 
                  id="description" 
                  [(ngModel)]="newContact.description"
                  name="description"
                  rows="3"
                  maxlength="500"
                  placeholder="Descripción del contacto..."
                  class="form-textarea"></textarea>
              </div>

              <div class="form-group full-width">
                <label for="image" class="form-label">
                  URL de Imagen
                </label>
                <input 
                  type="url" 
                  id="image" 
                  [(ngModel)]="newContact.image"
                  name="image"
                  placeholder="https://ejemplo.com/imagen.jpg"
                  class="form-input">
              </div>
            </div>

            @if (showError && errorMessage) {
              <div class="error-message">
                <svg viewBox="0 0 24 24">
                  <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
                </svg>
                {{ errorMessage }}
              </div>
            }

            <div class="form-actions">
              <button 
                type="button" 
                class="btn-secondary" 
                (click)="toggleContactForm()">
                Cancelar
              </button>
              <button 
                type="button" 
                class="btn-secondary" 
                (click)="crearContactoEjemplo()">
                Ejemplo
              </button>
              <button 
                type="submit" 
                class="btn-primary" 
                [disabled]="isSubmitting || !newContact.firstName || !newContact.number">
                @if (isSubmitting) {
                  Creando...
                } @else {
                  Crear Contacto
                }
              </button>
            </div>
          </form>
        </div>
      </div>

      <div class="contacts-container">
        @if (showNoResults) {
          <div class="no-results">
            <h3>No se encontraron contactos</h3>
            <p>Intenta con otros términos de búsqueda</p>
            <button class="btn-primary" (click)="clearSearch()">
              Limpiar búsqueda
            </button>
          </div>
        } @else if (showEmptyState) {
          <div class="empty-state">
            <div class="empty-icon">
            </div>
            <h3>No hay contactos</h3>
            <p>Comienza agregando tu primer contacto</p>
            <button class="btn-primary" (click)="toggleContactForm()">
              Crear Primer Contacto
            </button>
          </div>
        } @else if (hasContacts && filteredContacts.length > 0) {
          <div class="contacts-list">
            @for (contacto of filteredContacts; track contacto.id; let i = $index) {
              <app-contact-list-item 
                [contacto]="contacto" 
                [index]="i"
                (contactUpdated)="onContactUpdate()"
                (contactDeleted)="onContactDelete()">
              </app-contact-list-item>
            }
          </div>
        }
      </div>
    </div>
  }

  @if (!showContactForm) {
    <button class="floating-action-btn" (click)="toggleContactForm()">
    </button>
  }
</div>