<div class="contact-form-container">
  <div class="form-background"></div>
  
  <div class="floating-shapes">
    <div class="shape shape-1"></div>
    <div class="shape shape-2"></div>
    <div class="shape shape-3"></div>
  </div>

  <div class="contact-card">
    <div class="form-header">
      <div class="header-icon">
        <i class="fas" [class.fa-user-edit]="idContacto()" [class.fa-user-plus]="!idContacto()"></i>
      </div>
      <h2 class="form-title">
        @if(idContacto()) {
          Editar contacto
        } @else {
          Nuevo contacto
        }
      </h2>
      <p class="form-subtitle">
        @if(idContacto()) {
          Actualiza la información del contacto
        } @else {
          Agrega un nuevo contacto a tu lista
        }
      </p>
    </div>

    <form class="contact-form" (ngSubmit)="handleFormSubmission(newContactForm)" #newContactForm="ngForm">
      <div class="form-grid">
        <div class="form-group">
          <div class="input-container" [class]="getFieldClass(firstName)">
            <input 
              id="first-name" 
              name="firstName" 
              type="text" 
              ngModel 
              required 
              minlength="2" 
              maxlength="20" 
              #firstName="ngModel"
              (blur)="validateField(firstName, 'firstName')"
              placeholder=" "
              autocomplete="given-name">
            <label for="first-name" class="input-label">Nombre *</label>
            <i class="input-icon fas fa-user"></i>
            <div class="input-focus-border"></div>
          </div>
          @if (fieldStates()['firstName']) {
            <div class="error-message">
              <i class="fas fa-exclamation-circle"></i>
              {{ fieldStates()['firstName'] }}
            </div>
          }
        </div>

        <div class="form-group">
          <div class="input-container" [class]="getFieldClass(lastName)">
            <input 
              id="last-name" 
              name="lastName" 
              type="text" 
              ngModel 
              maxlength="20" 
              #lastName="ngModel"
              (blur)="validateField(lastName, 'lastName')"
              placeholder=" "
              autocomplete="family-name">
            <label for="last-name" class="input-label">Apellido</label>
            <i class="input-icon fas fa-user-tag"></i>
            <div class="input-focus-border"></div>
          </div>
          @if (fieldStates()['lastName']) {
            <div class="error-message">
              <i class="fas fa-exclamation-circle"></i>
              {{ fieldStates()['lastName'] }}
            </div>
          }
        </div>

        <div class="form-group">
          <div class="input-container" [class]="getFieldClass(number)">
            <input 
              id="phone" 
              name="number" 
              type="tel" 
              ngModel 
              required 
              minlength="3" 
              maxlength="30" 
              #number="ngModel"
              (blur)="validateField(number, 'number')"
              placeholder=" "
              autocomplete="tel">
            <label for="phone" class="input-label">Teléfono *</label>
            <i class="input-icon fas fa-phone"></i>
            <div class="input-focus-border"></div>
          </div>
          @if (fieldStates()['number']) {
            <div class="error-message">
              <i class="fas fa-exclamation-circle"></i>
              {{ fieldStates()['number'] }}
            </div>
          }
        </div>

        <div class="form-group">
          <div class="input-container" [class]="getFieldClass(email)">
            <input 
              id="email" 
              name="email" 
              type="email" 
              ngModel 
              maxlength="40" 
              #email="ngModel"
              (blur)="validateField(email, 'email')"
              placeholder=" "
              autocomplete="email">
            <label for="email" class="input-label">Email</label>
            <i class="input-icon fas fa-envelope"></i>
            <div class="input-focus-border"></div>
          </div>
          @if (fieldStates()['email']) {
            <div class="error-message">
              <i class="fas fa-exclamation-circle"></i>
              {{ fieldStates()['email'] }}
            </div>
          }
        </div>

        <div class="form-group full-width">
          <div class="input-container" [class]="getFieldClass(address)">
            <input 
              id="address" 
              name="address" 
              type="text" 
              ngModel 
              minlength="5" 
              #address="ngModel"
              (blur)="validateField(address, 'address')"
              placeholder=" "
              autocomplete="street-address">
            <label for="address" class="input-label">Dirección</label>
            <i class="input-icon fas fa-map-marker-alt"></i>
            <div class="input-focus-border"></div>
          </div>
          @if (fieldStates()['address']) {
            <div class="error-message">
              <i class="fas fa-exclamation-circle"></i>
              {{ fieldStates()['address'] }}
            </div>
          }
        </div>

        <div class="form-group">
          <div class="input-container" [class]="getFieldClass(company)">
            <input 
              id="company" 
              name="company" 
              type="text" 
              ngModel 
              minlength="2" 
              #company="ngModel"
              (blur)="validateField(company, 'company')"
              placeholder=" "
              autocomplete="organization">
            <label for="company" class="input-label">Compañía</label>
            <i class="input-icon fas fa-building"></i>
            <div class="input-focus-border"></div>
          </div>
          @if (fieldStates()['company']) {
            <div class="error-message">
              <i class="fas fa-exclamation-circle"></i>
              {{ fieldStates()['company'] }}
            </div>
          }
        </div>

        <div class="form-group full-width">
          <div class="input-container" [class]="getFieldClass(description)">
            <textarea 
              id="description" 
              name="description" 
              ngModel 
              maxlength="500" 
              #description="ngModel"
              (blur)="validateField(description, 'description')"
              placeholder=" "
              rows="3"
              class="form-textarea"></textarea>
            <label for="description" class="input-label">Descripción</label>
            <i class="input-icon fas fa-file-alt"></i>
            <div class="input-focus-border"></div>
          </div>
          @if (fieldStates()['description']) {
            <div class="error-message">
              <i class="fas fa-exclamation-circle"></i>
              {{ fieldStates()['description'] }}
            </div>
          }
        </div>

        <div class="form-group full-width">
          <div class="input-container" [class]="getFieldClass(image)">
            <input 
              id="image" 
              name="image" 
              type="url" 
              ngModel 
              #image="ngModel"
              (blur)="validateField(image, 'image')"
              placeholder=" "
              autocomplete="photo">
            <label for="image" class="input-label">URL Imagen</label>
            <i class="input-icon fas fa-image"></i>
            <div class="input-focus-border"></div>
          </div>
          @if (fieldStates()['image']) {
            <div class="error-message">
              <i class="fas fa-exclamation-circle"></i>
              {{ fieldStates()['image'] }}
            </div>
          }
        </div>
      </div>

      @if (errorEnBack()) {
        <div class="error-banner">
          <i class="fas fa-exclamation-triangle"></i>
          <span>{{ errorMessage() }}</span>
        </div>
      }

      <div class="form-actions">
        <button type="button" class="btn-secondary" (click)="cancel()" [disabled]="solicitudABackEnCurso()">
          <i class="fas fa-times"></i>
          Cancelar
        </button>
        <button type="submit" class="btn-primary" [disabled]="newContactForm.invalid || solicitudABackEnCurso()">
          <i class="fas" [class.fa-save]="idContacto()" [class.fa-plus]="!idContacto()"></i>
          @if(idContacto()) {
            Actualizar contacto
          } @else {
            Crear contacto
          }
        </button>
      </div>
    </form>
  </div>
</div>