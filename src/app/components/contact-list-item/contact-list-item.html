<div class="contact-list-item" 
     [class]="variant()"
     [class.favorite]="contacto().isFavorite"
     (click)="onContactClick()"
     role="button"
     tabindex="0">
  
  <div class="contact-avatar">
    @if (contacto().image) {
      <img [src]="contacto().image" 
           [alt]="getFullName()" 
           class="avatar-image"
           (error)="contacto().image = ''">
    } @else {
      <div class="avatar-initials">
        {{ getContactInitials() }}
      </div>
    }
    
    @if (contacto().isFavorite) {
      <div class="favorite-badge" title="Contacto favorito">
        <svg class="star-icon" viewBox="0 0 24 24">
          <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
        </svg>
      </div>
    }
  </div>

  <div class="contact-info">
    <div class="contact-header">
      <h3 class="contact-name">{{ getFullName() }}</h3>
      
      @if (showIndex()) {
        <span class="contact-index">#{{ index() + 1 }}</span>
      }
    </div>
  </div>

  @if (showActions()) {
    <div class="contact-actions" (click)="$event.stopPropagation()">
      <button class="btn-icon favorite-btn"
              [class.favorited]="contacto().isFavorite"
              [class.loading]="isTogglingFavorite"
              (click)="onToggleFavorite($event)"
              [title]="contacto().isFavorite ? 'Quitar de favoritos' : 'Agregar a favoritos'"
              [disabled]="isTogglingFavorite">
        <svg class="action-icon" viewBox="0 0 24 24">
          @if (isTogglingFavorite) {
            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none" 
                    stroke-dasharray="15.85 15.85" stroke-dashoffset="0">
              <animateTransform attributeName="transform" type="rotate" from="0 12 12" to="360 12 12" 
                              dur="1s" repeatCount="indefinite"/>
            </circle>
          } @else {
            <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
          }
        </svg>
      </button>

      <button class="btn-icon edit-btn"
              (click)="onEditContact($event)"
              title="Editar contacto">
        <svg class="action-icon" viewBox="0 0 24 24">
          <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
        </svg>
      </button>

      <button class="btn-icon delete-btn"
              [class.loading]="isDeleting"
              (click)="showDeleteModal()"
              [title]="isDeleting ? 'Eliminando...' : 'Eliminar contacto'"
              [disabled]="isDeleting">
        <svg class="action-icon" viewBox="0 0 24 24">
          @if (isDeleting) {
            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none" 
                    stroke-dasharray="15.85 15.85" stroke-dashoffset="0">
              <animateTransform attributeName="transform" type="rotate" from="0 12 12" to="360 12 12" 
                              dur="1s" repeatCount="indefinite"/>
            </circle>
          } @else {
            <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
          }
        </svg>
      </button>
    </div>
  }
</div>